name: PR checkers B
on:
  pull_request:
    paths:
      - 'serviceB/**'
      - .github/workflows/serviceB-pr.yml

jobs:
  unit-tests:
    runs-on: ubuntu-latest
    container:
      image: ubuntu
      volumes:
       - /var/run/docker.sock:/var/run/docker.sock
    steps:
      - name: Check out repository code
        uses: actions/checkout@v2
      - name: load/create cache for make tasks
        uses: actions/cache@v2
        with:
          path: out/**
          key: ${{ runner.os }}-build-${{ github.sha }}
      - run: apt-get update; apt-get install make
      - run: make check_files_on_out || true
      - run: make integration-test1
      - shell: bash
        run: make write_on_out
      - run: make integration-test2
      - run: make check_files_on_out || true

